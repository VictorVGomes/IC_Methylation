---
title: "ParkinsonsDisease"
author: "Victor Vinícius Gomes"
format: pdf
editor: visual
---

# Efeito do fumo na metilação do DNA em células CD8T do sangue humano

A instalação dos pacotes a serem utilizados é o primeiro passo para iniciar a análise de dados de metilação. Usando a função do pacote `BiocManager` , `install()` , instala-se os pacotes necessários, e listados nos códigos. Alguns têm tamanho mediano, e podem levar algum tempo até serem instalados.

#### Pacotes exigidos

```{r}
knitr::opts_chunk$set(echo = TRUE)
# pacotes usados e que não são do Bioconductor
pacotes = c("fs")

for(pacote in pacotes)
  if(!pacote %in% installed.packages())
    install.packages(pacote)
  library(pacote, character.only = TRUE)


library(minfi)
# library(GEOquery)
# library(IlluminaHumanMethylation450kmanifest)
# library(IlluminaHumanMethylation450kanno.ilmn12.hg19)
# BiocManager::install("IlluminaHumanMethylationEPICanno.ilm10b2.hg19")




```

Após a instalação dos pacotes, pode-se iniciar a leitura dos dados.

`Como é uma parte que depende de como os dados foram coletados, cada experimento pode fazer essa parte de forma diferente, mas a ideia geral é a mesma, podendo-se generalizar boa parte dos passos aqui descritos, com pequenas alterações para comportar os diferentes experimentos possíveis.`

#### Início da leitura dos dados

No caso dos dados sobre fumo, os arquivos .IDAT estão disponíveis em dois tipos: experimentos 450k e experimentos EPIC (850k). Como forma de usar ambos

```{r}

# untar("GSE147430_RAW.tar", exdir = "GSE147430") # só deve ser feito uma vez

idatFiles = paste0('GSE147430/',list.files('GSE147430/', pattern = "idat"))
# nomes dos arquivos idat com a adição do caminho até eles do diretório atual

# 91% dos arquivos são 450k (121)
# os outros 9% são EPIC arrays (11)
# total de 132 pacientes (121+11)

files_450k = idatFiles[(file.size(idatFiles) < 5000000)] # file.size mede em bytes
files_EPIC = idatFiles[!(file.size(idatFiles) < 5000000)]


# Os arquivos serão lidos separadamente e, depois, unidos usando a função 
# combineArrays() do pacote minfi, e o produto final será um 450k set, pois
# como a maioria dos dados é 450k, teríamos muitos dados faltantes usando os
# 850k no geral.

# Para a leitura dos arquivos de forma separada, serão criados 2 diretórios:
# o diretório para 450k e o para EPIC arrays

dir_450k = "450kIdatFiles"
dir_EPIC = "EPICIdatFiles"


cria_dir_adiciona_arquivos = function(nomeDir, arquivos, print_results=FALSE){
  wd = paste0(getwd(), "/")
  caminho = paste0(wd, nomeDir)
  
  if(!dir.exists(caminho))
    dir.create(caminho)         # cria o diretório se esse não existe                      
  
  arquivos_ = unlist(strsplit(arquivos, split = "/", fixed = T))[seq(2, length(arquivos) * 2, 2)]
  
  arquivos = arquivos[which(!arquivos_ %in% list.files(caminho))]
  if(length(arquivos)!=0) file.copy(from = paste0(wd, arquivos), to = paste0(caminho,"/", arquivos_))
  
  if (print_results)
    print(list.files(caminho))
}

    
# Criando diretórios para 450k e EPIC
# não é necessário rodar mais que uma vez as funções

cria_dir_adiciona_arquivos(nomeDir = dir_450k, arquivos = files_450k)
cria_dir_adiciona_arquivos(nomeDir = dir_EPIC, arquivos = files_EPIC)


# checando se o tamanho permanece o mesmo, mas em pastas separadas

tam_separado = (sum(file.size(paste0(dir_EPIC, "/",list.files(dir_EPIC))))
                + sum(file.size(paste0(dir_450k, "/",list.files(dir_450k))))) / 1e6

tam_original = sum(file.size(idatFiles)) / 1e6


print(tam_separado == tam_original)

# removendo arquivos do diretório original usados para criar
# os dois diretórios separados

unlink(idatFiles)



# pronto para ler os arquivos 450k e EPIC em datasets separados



# rgSet450k = read.metharray.exp()

```

```{r}
# getGEOSuppFiles("GSE195834") # Só deve ser rodado uma vez, para baixar os arquivos auxiliares
```

```{r}

```
